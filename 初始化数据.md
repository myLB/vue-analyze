# 初始化数据
起这个标题是因为我觉得下面这些处理其实就是在初始化数据。经过上一章节已经把`$options`中的所有数据规范化了,那么继续回到`_init`函数来执行
下面的语句

```ecmascript 6
vm._self = vm
```
设置实例的`_self`为自身

## 初始化一些生命周期属性

```ecmascript 6
initLifecycle(vm)
```
回到`_init`函数中来,可以看到接下来是执行`initLifecycle`函数,这个函数在`core\instance\lifecycle.js`文件中.

```ecmascript 6
export function initLifecycle (vm: Component) {
  //缓存合并处理过后的$options
  const options = vm.$options

  // locate first non-abstract parent
  //缓存当前实例的父组件
  let parent = options.parent
  //父组件存在并且当前实例不是抽象的
  /*
    抽象组件: keep-alive、transition这些
      特点1、一般不渲染真实DOM
      特点2、不会出现在父子关系的路径上
  */
  if (parent && !options.abstract) {
    /*parent是抽象组件并且parent存在父组件*/
    while (parent.$options.abstract && parent.$parent) {
      //将parent的父组件赋值给parent
      parent = parent.$parent
    }
    //直到循环parent不为抽象组件时退出，也就是获取当前实例的第一个非抽象的父组件,
    //将当前实例push进这个父组件的子组件属性$children中
    parent.$children.push(vm)
  }
  //缓存当前实例的第一个非抽象组件
  vm.$parent = parent
  //父组件存在则缓存父组件的根组件 不存在则缓存自身，表示自身就是根组件
  vm.$root = parent ? parent.$root : vm
  //设置当前实例的$children为[]
  vm.$children = []
  //设置当前实例的$refs为{}
  vm.$refs = {}
  //设置当前_watcher为空
  vm._watcher = null
  //设置当前_inactive为空
  vm._inactive = null
  //设置当前_directInactive为false
  vm._directInactive = false
  //设置当前_isMounted为false
  vm._isMounted = false
  //设置当前_isDestroyed为false
  vm._isDestroyed = false
  //设置当前_isBeingDestroyed为false
  vm._isBeingDestroyed = false
}
```
可以看到读取了实例的`$options`对象,并在该对象中初始化了多个属性,下面来一一看其的作用:

   - `$parent`: 存放非抽象的父组件,非抽象特点:不渲染真实组件,比如: `keepAlive`
    
   - `$children`: 用于存放子组件的集合 

   - `$parent.$children`: 在父组件中存放自身

   - `$root`: 存放根组件
   
   - `$refs`: 存放该组件中所有存在`ref`属性的节点
   
   - `_watcher`: 渲染函数的观察者实例

   - `_inactive`: 表示该组件是否激活, `false`代表激活  `true`或`null`代表未激活 

   - `_directInactive`:  表示`keep-alive`中组件状态的属性,表示是否要激活 比如父组件未激活 那么其也不会激活

   - `_isMounted`: 用于表示该组件是否还挂载着 

   - `_isDestroyed`: 表示该组件是否已销毁

   - `_isBeingDestroyed`: 表示该组件是否正在销毁中 


## 初始化监听事件
```ecmascript 6
initEvents(vm)
```
该函数在`core\instance\events.js`文件中
```ecmascript 6
export function initEvents (vm: Component) {
  //当前实例的_events赋值为原型为空的空对象
  vm._events = Object.create(null)
  //当前实例的_hasHookEvent为false
  vm._hasHookEvent = false
  // init parent attached events
  const listeners = vm.$options._parentListeners
  if (listeners) {
    updateComponentListeners(vm, listeners)
  }
}
```








































